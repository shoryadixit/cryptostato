{"ast":null,"code":"module.exports = Tokenizer;\n\nvar decodeCodePoint = require(\"entities/lib/decode_codepoint.js\");\n\nvar entityMap = require(\"entities/maps/entities.json\");\n\nvar legacyMap = require(\"entities/maps/legacy.json\");\n\nvar xmlMap = require(\"entities/maps/xml.json\");\n\nvar i = 0;\nvar TEXT = i++;\nvar BEFORE_TAG_NAME = i++; //after <\n\nvar IN_TAG_NAME = i++;\nvar IN_SELF_CLOSING_TAG = i++;\nvar BEFORE_CLOSING_TAG_NAME = i++;\nvar IN_CLOSING_TAG_NAME = i++;\nvar AFTER_CLOSING_TAG_NAME = i++; //attributes\n\nvar BEFORE_ATTRIBUTE_NAME = i++;\nvar IN_ATTRIBUTE_NAME = i++;\nvar AFTER_ATTRIBUTE_NAME = i++;\nvar BEFORE_ATTRIBUTE_VALUE = i++;\nvar IN_ATTRIBUTE_VALUE_DQ = i++; // \"\n\nvar IN_ATTRIBUTE_VALUE_SQ = i++; // '\n\nvar IN_ATTRIBUTE_VALUE_NQ = i++; //declarations\n\nvar BEFORE_DECLARATION = i++; // !\n\nvar IN_DECLARATION = i++; //processing instructions\n\nvar IN_PROCESSING_INSTRUCTION = i++; // ?\n//comments\n\nvar BEFORE_COMMENT = i++;\nvar IN_COMMENT = i++;\nvar AFTER_COMMENT_1 = i++;\nvar AFTER_COMMENT_2 = i++; //cdata\n\nvar BEFORE_CDATA_1 = i++; // [\n\nvar BEFORE_CDATA_2 = i++; // C\n\nvar BEFORE_CDATA_3 = i++; // D\n\nvar BEFORE_CDATA_4 = i++; // A\n\nvar BEFORE_CDATA_5 = i++; // T\n\nvar BEFORE_CDATA_6 = i++; // A\n\nvar IN_CDATA = i++; // [\n\nvar AFTER_CDATA_1 = i++; // ]\n\nvar AFTER_CDATA_2 = i++; // ]\n//special tags\n\nvar BEFORE_SPECIAL = i++; //S\n\nvar BEFORE_SPECIAL_END = i++; //S\n\nvar BEFORE_SCRIPT_1 = i++; //C\n\nvar BEFORE_SCRIPT_2 = i++; //R\n\nvar BEFORE_SCRIPT_3 = i++; //I\n\nvar BEFORE_SCRIPT_4 = i++; //P\n\nvar BEFORE_SCRIPT_5 = i++; //T\n\nvar AFTER_SCRIPT_1 = i++; //C\n\nvar AFTER_SCRIPT_2 = i++; //R\n\nvar AFTER_SCRIPT_3 = i++; //I\n\nvar AFTER_SCRIPT_4 = i++; //P\n\nvar AFTER_SCRIPT_5 = i++; //T\n\nvar BEFORE_STYLE_1 = i++; //T\n\nvar BEFORE_STYLE_2 = i++; //Y\n\nvar BEFORE_STYLE_3 = i++; //L\n\nvar BEFORE_STYLE_4 = i++; //E\n\nvar AFTER_STYLE_1 = i++; //T\n\nvar AFTER_STYLE_2 = i++; //Y\n\nvar AFTER_STYLE_3 = i++; //L\n\nvar AFTER_STYLE_4 = i++; //E\n\nvar BEFORE_ENTITY = i++; //&\n\nvar BEFORE_NUMERIC_ENTITY = i++; //#\n\nvar IN_NAMED_ENTITY = i++;\nvar IN_NUMERIC_ENTITY = i++;\nvar IN_HEX_ENTITY = i++; //X\n\nvar j = 0;\nvar SPECIAL_NONE = j++;\nvar SPECIAL_SCRIPT = j++;\nvar SPECIAL_STYLE = j++;\n\nfunction whitespace(c) {\n  return c === \" \" || c === \"\\n\" || c === \"\\t\" || c === \"\\f\" || c === \"\\r\";\n}\n\nfunction ifElseState(upper, SUCCESS, FAILURE) {\n  var lower = upper.toLowerCase();\n\n  if (upper === lower) {\n    return function (c) {\n      if (c === lower) {\n        this._state = SUCCESS;\n      } else {\n        this._state = FAILURE;\n        this._index--;\n      }\n    };\n  } else {\n    return function (c) {\n      if (c === lower || c === upper) {\n        this._state = SUCCESS;\n      } else {\n        this._state = FAILURE;\n        this._index--;\n      }\n    };\n  }\n}\n\nfunction consumeSpecialNameChar(upper, NEXT_STATE) {\n  var lower = upper.toLowerCase();\n  return function (c) {\n    if (c === lower || c === upper) {\n      this._state = NEXT_STATE;\n    } else {\n      this._state = IN_TAG_NAME;\n      this._index--; //consume the token again\n    }\n  };\n}\n\nfunction Tokenizer(options, cbs) {\n  this._state = TEXT;\n  this._buffer = \"\";\n  this._sectionStart = 0;\n  this._index = 0;\n  this._bufferOffset = 0; //chars removed from _buffer\n\n  this._baseState = TEXT;\n  this._special = SPECIAL_NONE;\n  this._cbs = cbs;\n  this._running = true;\n  this._ended = false;\n  this._xmlMode = !!(options && options.xmlMode);\n  this._decodeEntities = !!(options && options.decodeEntities);\n}\n\nTokenizer.prototype._stateText = function (c) {\n  if (c === \"<\") {\n    if (this._index > this._sectionStart) {\n      this._cbs.ontext(this._getSection());\n    }\n\n    this._state = BEFORE_TAG_NAME;\n    this._sectionStart = this._index;\n  } else if (this._decodeEntities && this._special === SPECIAL_NONE && c === \"&\") {\n    if (this._index > this._sectionStart) {\n      this._cbs.ontext(this._getSection());\n    }\n\n    this._baseState = TEXT;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateBeforeTagName = function (c) {\n  if (c === \"/\") {\n    this._state = BEFORE_CLOSING_TAG_NAME;\n  } else if (c === \"<\") {\n    this._cbs.ontext(this._getSection());\n\n    this._sectionStart = this._index;\n  } else if (c === \">\" || this._special !== SPECIAL_NONE || whitespace(c)) {\n    this._state = TEXT;\n  } else if (c === \"!\") {\n    this._state = BEFORE_DECLARATION;\n    this._sectionStart = this._index + 1;\n  } else if (c === \"?\") {\n    this._state = IN_PROCESSING_INSTRUCTION;\n    this._sectionStart = this._index + 1;\n  } else {\n    this._state = !this._xmlMode && (c === \"s\" || c === \"S\") ? BEFORE_SPECIAL : IN_TAG_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInTagName = function (c) {\n  if (c === \"/\" || c === \">\" || whitespace(c)) {\n    this._emitToken(\"onopentagname\");\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateBeforeCloseingTagName = function (c) {\n  if (whitespace(c)) ;else if (c === \">\") {\n    this._state = TEXT;\n  } else if (this._special !== SPECIAL_NONE) {\n    if (c === \"s\" || c === \"S\") {\n      this._state = BEFORE_SPECIAL_END;\n    } else {\n      this._state = TEXT;\n      this._index--;\n    }\n  } else {\n    this._state = IN_CLOSING_TAG_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInCloseingTagName = function (c) {\n  if (c === \">\" || whitespace(c)) {\n    this._emitToken(\"onclosetag\");\n\n    this._state = AFTER_CLOSING_TAG_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateAfterCloseingTagName = function (c) {\n  //skip everything until \">\"\n  if (c === \">\") {\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  }\n};\n\nTokenizer.prototype._stateBeforeAttributeName = function (c) {\n  if (c === \">\") {\n    this._cbs.onopentagend();\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (c === \"/\") {\n    this._state = IN_SELF_CLOSING_TAG;\n  } else if (!whitespace(c)) {\n    this._state = IN_ATTRIBUTE_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInSelfClosingTag = function (c) {\n  if (c === \">\") {\n    this._cbs.onselfclosingtag();\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (!whitespace(c)) {\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateInAttributeName = function (c) {\n  if (c === \"=\" || c === \"/\" || c === \">\" || whitespace(c)) {\n    this._cbs.onattribname(this._getSection());\n\n    this._sectionStart = -1;\n    this._state = AFTER_ATTRIBUTE_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateAfterAttributeName = function (c) {\n  if (c === \"=\") {\n    this._state = BEFORE_ATTRIBUTE_VALUE;\n  } else if (c === \"/\" || c === \">\") {\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  } else if (!whitespace(c)) {\n    this._cbs.onattribend();\n\n    this._state = IN_ATTRIBUTE_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateBeforeAttributeValue = function (c) {\n  if (c === '\"') {\n    this._state = IN_ATTRIBUTE_VALUE_DQ;\n    this._sectionStart = this._index + 1;\n  } else if (c === \"'\") {\n    this._state = IN_ATTRIBUTE_VALUE_SQ;\n    this._sectionStart = this._index + 1;\n  } else if (!whitespace(c)) {\n    this._state = IN_ATTRIBUTE_VALUE_NQ;\n    this._sectionStart = this._index;\n    this._index--; //reconsume token\n  }\n};\n\nTokenizer.prototype._stateInAttributeValueDoubleQuotes = function (c) {\n  if (c === '\"') {\n    this._emitToken(\"onattribdata\");\n\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n  } else if (this._decodeEntities && c === \"&\") {\n    this._emitToken(\"onattribdata\");\n\n    this._baseState = this._state;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInAttributeValueSingleQuotes = function (c) {\n  if (c === \"'\") {\n    this._emitToken(\"onattribdata\");\n\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n  } else if (this._decodeEntities && c === \"&\") {\n    this._emitToken(\"onattribdata\");\n\n    this._baseState = this._state;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInAttributeValueNoQuotes = function (c) {\n  if (whitespace(c) || c === \">\") {\n    this._emitToken(\"onattribdata\");\n\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  } else if (this._decodeEntities && c === \"&\") {\n    this._emitToken(\"onattribdata\");\n\n    this._baseState = this._state;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateBeforeDeclaration = function (c) {\n  this._state = c === \"[\" ? BEFORE_CDATA_1 : c === \"-\" ? BEFORE_COMMENT : IN_DECLARATION;\n};\n\nTokenizer.prototype._stateInDeclaration = function (c) {\n  if (c === \">\") {\n    this._cbs.ondeclaration(this._getSection());\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  }\n};\n\nTokenizer.prototype._stateInProcessingInstruction = function (c) {\n  if (c === \">\") {\n    this._cbs.onprocessinginstruction(this._getSection());\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  }\n};\n\nTokenizer.prototype._stateBeforeComment = function (c) {\n  if (c === \"-\") {\n    this._state = IN_COMMENT;\n    this._sectionStart = this._index + 1;\n  } else {\n    this._state = IN_DECLARATION;\n  }\n};\n\nTokenizer.prototype._stateInComment = function (c) {\n  if (c === \"-\") this._state = AFTER_COMMENT_1;\n};\n\nTokenizer.prototype._stateAfterComment1 = function (c) {\n  if (c === \"-\") {\n    this._state = AFTER_COMMENT_2;\n  } else {\n    this._state = IN_COMMENT;\n  }\n};\n\nTokenizer.prototype._stateAfterComment2 = function (c) {\n  if (c === \">\") {\n    //remove 2 trailing chars\n    this._cbs.oncomment(this._buffer.substring(this._sectionStart, this._index - 2));\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (c !== \"-\") {\n    this._state = IN_COMMENT;\n  } // else: stay in AFTER_COMMENT_2 (`--->`)\n\n};\n\nTokenizer.prototype._stateBeforeCdata1 = ifElseState(\"C\", BEFORE_CDATA_2, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata2 = ifElseState(\"D\", BEFORE_CDATA_3, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata3 = ifElseState(\"A\", BEFORE_CDATA_4, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata4 = ifElseState(\"T\", BEFORE_CDATA_5, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata5 = ifElseState(\"A\", BEFORE_CDATA_6, IN_DECLARATION);\n\nTokenizer.prototype._stateBeforeCdata6 = function (c) {\n  if (c === \"[\") {\n    this._state = IN_CDATA;\n    this._sectionStart = this._index + 1;\n  } else {\n    this._state = IN_DECLARATION;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateInCdata = function (c) {\n  if (c === \"]\") this._state = AFTER_CDATA_1;\n};\n\nTokenizer.prototype._stateAfterCdata1 = function (c) {\n  if (c === \"]\") this._state = AFTER_CDATA_2;else this._state = IN_CDATA;\n};\n\nTokenizer.prototype._stateAfterCdata2 = function (c) {\n  if (c === \">\") {\n    //remove 2 trailing chars\n    this._cbs.oncdata(this._buffer.substring(this._sectionStart, this._index - 2));\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (c !== \"]\") {\n    this._state = IN_CDATA;\n  } //else: stay in AFTER_CDATA_2 (`]]]>`)\n\n};\n\nTokenizer.prototype._stateBeforeSpecial = function (c) {\n  if (c === \"c\" || c === \"C\") {\n    this._state = BEFORE_SCRIPT_1;\n  } else if (c === \"t\" || c === \"T\") {\n    this._state = BEFORE_STYLE_1;\n  } else {\n    this._state = IN_TAG_NAME;\n    this._index--; //consume the token again\n  }\n};\n\nTokenizer.prototype._stateBeforeSpecialEnd = function (c) {\n  if (this._special === SPECIAL_SCRIPT && (c === \"c\" || c === \"C\")) {\n    this._state = AFTER_SCRIPT_1;\n  } else if (this._special === SPECIAL_STYLE && (c === \"t\" || c === \"T\")) {\n    this._state = AFTER_STYLE_1;\n  } else this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeScript1 = consumeSpecialNameChar(\"R\", BEFORE_SCRIPT_2);\nTokenizer.prototype._stateBeforeScript2 = consumeSpecialNameChar(\"I\", BEFORE_SCRIPT_3);\nTokenizer.prototype._stateBeforeScript3 = consumeSpecialNameChar(\"P\", BEFORE_SCRIPT_4);\nTokenizer.prototype._stateBeforeScript4 = consumeSpecialNameChar(\"T\", BEFORE_SCRIPT_5);\n\nTokenizer.prototype._stateBeforeScript5 = function (c) {\n  if (c === \"/\" || c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_SCRIPT;\n  }\n\n  this._state = IN_TAG_NAME;\n  this._index--; //consume the token again\n};\n\nTokenizer.prototype._stateAfterScript1 = ifElseState(\"R\", AFTER_SCRIPT_2, TEXT);\nTokenizer.prototype._stateAfterScript2 = ifElseState(\"I\", AFTER_SCRIPT_3, TEXT);\nTokenizer.prototype._stateAfterScript3 = ifElseState(\"P\", AFTER_SCRIPT_4, TEXT);\nTokenizer.prototype._stateAfterScript4 = ifElseState(\"T\", AFTER_SCRIPT_5, TEXT);\n\nTokenizer.prototype._stateAfterScript5 = function (c) {\n  if (c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_NONE;\n    this._state = IN_CLOSING_TAG_NAME;\n    this._sectionStart = this._index - 6;\n    this._index--; //reconsume the token\n  } else this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeStyle1 = consumeSpecialNameChar(\"Y\", BEFORE_STYLE_2);\nTokenizer.prototype._stateBeforeStyle2 = consumeSpecialNameChar(\"L\", BEFORE_STYLE_3);\nTokenizer.prototype._stateBeforeStyle3 = consumeSpecialNameChar(\"E\", BEFORE_STYLE_4);\n\nTokenizer.prototype._stateBeforeStyle4 = function (c) {\n  if (c === \"/\" || c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_STYLE;\n  }\n\n  this._state = IN_TAG_NAME;\n  this._index--; //consume the token again\n};\n\nTokenizer.prototype._stateAfterStyle1 = ifElseState(\"Y\", AFTER_STYLE_2, TEXT);\nTokenizer.prototype._stateAfterStyle2 = ifElseState(\"L\", AFTER_STYLE_3, TEXT);\nTokenizer.prototype._stateAfterStyle3 = ifElseState(\"E\", AFTER_STYLE_4, TEXT);\n\nTokenizer.prototype._stateAfterStyle4 = function (c) {\n  if (c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_NONE;\n    this._state = IN_CLOSING_TAG_NAME;\n    this._sectionStart = this._index - 5;\n    this._index--; //reconsume the token\n  } else this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeEntity = ifElseState(\"#\", BEFORE_NUMERIC_ENTITY, IN_NAMED_ENTITY);\nTokenizer.prototype._stateBeforeNumericEntity = ifElseState(\"X\", IN_HEX_ENTITY, IN_NUMERIC_ENTITY); //for entities terminated with a semicolon\n\nTokenizer.prototype._parseNamedEntityStrict = function () {\n  //offset = 1\n  if (this._sectionStart + 1 < this._index) {\n    var entity = this._buffer.substring(this._sectionStart + 1, this._index),\n        map = this._xmlMode ? xmlMap : entityMap;\n\n    if (map.hasOwnProperty(entity)) {\n      this._emitPartial(map[entity]);\n\n      this._sectionStart = this._index + 1;\n    }\n  }\n}; //parses legacy entities (without trailing semicolon)\n\n\nTokenizer.prototype._parseLegacyEntity = function () {\n  var start = this._sectionStart + 1,\n      limit = this._index - start;\n  if (limit > 6) limit = 6; //the max length of legacy entities is 6\n\n  while (limit >= 2) {\n    //the min length of legacy entities is 2\n    var entity = this._buffer.substr(start, limit);\n\n    if (legacyMap.hasOwnProperty(entity)) {\n      this._emitPartial(legacyMap[entity]);\n\n      this._sectionStart += limit + 1;\n      return;\n    } else {\n      limit--;\n    }\n  }\n};\n\nTokenizer.prototype._stateInNamedEntity = function (c) {\n  if (c === \";\") {\n    this._parseNamedEntityStrict();\n\n    if (this._sectionStart + 1 < this._index && !this._xmlMode) {\n      this._parseLegacyEntity();\n    }\n\n    this._state = this._baseState;\n  } else if ((c < \"a\" || c > \"z\") && (c < \"A\" || c > \"Z\") && (c < \"0\" || c > \"9\")) {\n    if (this._xmlMode) ;else if (this._sectionStart + 1 === this._index) ;else if (this._baseState !== TEXT) {\n      if (c !== \"=\") {\n        this._parseNamedEntityStrict();\n      }\n    } else {\n      this._parseLegacyEntity();\n    }\n    this._state = this._baseState;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._decodeNumericEntity = function (offset, base) {\n  var sectionStart = this._sectionStart + offset;\n\n  if (sectionStart !== this._index) {\n    //parse entity\n    var entity = this._buffer.substring(sectionStart, this._index);\n\n    var parsed = parseInt(entity, base);\n\n    this._emitPartial(decodeCodePoint(parsed));\n\n    this._sectionStart = this._index;\n  } else {\n    this._sectionStart--;\n  }\n\n  this._state = this._baseState;\n};\n\nTokenizer.prototype._stateInNumericEntity = function (c) {\n  if (c === \";\") {\n    this._decodeNumericEntity(2, 10);\n\n    this._sectionStart++;\n  } else if (c < \"0\" || c > \"9\") {\n    if (!this._xmlMode) {\n      this._decodeNumericEntity(2, 10);\n    } else {\n      this._state = this._baseState;\n    }\n\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateInHexEntity = function (c) {\n  if (c === \";\") {\n    this._decodeNumericEntity(3, 16);\n\n    this._sectionStart++;\n  } else if ((c < \"a\" || c > \"f\") && (c < \"A\" || c > \"F\") && (c < \"0\" || c > \"9\")) {\n    if (!this._xmlMode) {\n      this._decodeNumericEntity(3, 16);\n    } else {\n      this._state = this._baseState;\n    }\n\n    this._index--;\n  }\n};\n\nTokenizer.prototype._cleanup = function () {\n  if (this._sectionStart < 0) {\n    this._buffer = \"\";\n    this._bufferOffset += this._index;\n    this._index = 0;\n  } else if (this._running) {\n    if (this._state === TEXT) {\n      if (this._sectionStart !== this._index) {\n        this._cbs.ontext(this._buffer.substr(this._sectionStart));\n      }\n\n      this._buffer = \"\";\n      this._bufferOffset += this._index;\n      this._index = 0;\n    } else if (this._sectionStart === this._index) {\n      //the section just started\n      this._buffer = \"\";\n      this._bufferOffset += this._index;\n      this._index = 0;\n    } else {\n      //remove everything unnecessary\n      this._buffer = this._buffer.substr(this._sectionStart);\n      this._index -= this._sectionStart;\n      this._bufferOffset += this._sectionStart;\n    }\n\n    this._sectionStart = 0;\n  }\n}; //TODO make events conditional\n\n\nTokenizer.prototype.write = function (chunk) {\n  if (this._ended) this._cbs.onerror(Error(\".write() after done!\"));\n  this._buffer += chunk;\n\n  this._parse();\n};\n\nTokenizer.prototype._parse = function () {\n  while (this._index < this._buffer.length && this._running) {\n    var c = this._buffer.charAt(this._index);\n\n    if (this._state === TEXT) {\n      this._stateText(c);\n    } else if (this._state === BEFORE_TAG_NAME) {\n      this._stateBeforeTagName(c);\n    } else if (this._state === IN_TAG_NAME) {\n      this._stateInTagName(c);\n    } else if (this._state === BEFORE_CLOSING_TAG_NAME) {\n      this._stateBeforeCloseingTagName(c);\n    } else if (this._state === IN_CLOSING_TAG_NAME) {\n      this._stateInCloseingTagName(c);\n    } else if (this._state === AFTER_CLOSING_TAG_NAME) {\n      this._stateAfterCloseingTagName(c);\n    } else if (this._state === IN_SELF_CLOSING_TAG) {\n      this._stateInSelfClosingTag(c);\n    } else if (this._state === BEFORE_ATTRIBUTE_NAME) {\n      /*\r\n      *\tattributes\r\n      */\n      this._stateBeforeAttributeName(c);\n    } else if (this._state === IN_ATTRIBUTE_NAME) {\n      this._stateInAttributeName(c);\n    } else if (this._state === AFTER_ATTRIBUTE_NAME) {\n      this._stateAfterAttributeName(c);\n    } else if (this._state === BEFORE_ATTRIBUTE_VALUE) {\n      this._stateBeforeAttributeValue(c);\n    } else if (this._state === IN_ATTRIBUTE_VALUE_DQ) {\n      this._stateInAttributeValueDoubleQuotes(c);\n    } else if (this._state === IN_ATTRIBUTE_VALUE_SQ) {\n      this._stateInAttributeValueSingleQuotes(c);\n    } else if (this._state === IN_ATTRIBUTE_VALUE_NQ) {\n      this._stateInAttributeValueNoQuotes(c);\n    } else if (this._state === BEFORE_DECLARATION) {\n      /*\r\n      *\tdeclarations\r\n      */\n      this._stateBeforeDeclaration(c);\n    } else if (this._state === IN_DECLARATION) {\n      this._stateInDeclaration(c);\n    } else if (this._state === IN_PROCESSING_INSTRUCTION) {\n      /*\r\n      *\tprocessing instructions\r\n      */\n      this._stateInProcessingInstruction(c);\n    } else if (this._state === BEFORE_COMMENT) {\n      /*\r\n      *\tcomments\r\n      */\n      this._stateBeforeComment(c);\n    } else if (this._state === IN_COMMENT) {\n      this._stateInComment(c);\n    } else if (this._state === AFTER_COMMENT_1) {\n      this._stateAfterComment1(c);\n    } else if (this._state === AFTER_COMMENT_2) {\n      this._stateAfterComment2(c);\n    } else if (this._state === BEFORE_CDATA_1) {\n      /*\r\n      *\tcdata\r\n      */\n      this._stateBeforeCdata1(c);\n    } else if (this._state === BEFORE_CDATA_2) {\n      this._stateBeforeCdata2(c);\n    } else if (this._state === BEFORE_CDATA_3) {\n      this._stateBeforeCdata3(c);\n    } else if (this._state === BEFORE_CDATA_4) {\n      this._stateBeforeCdata4(c);\n    } else if (this._state === BEFORE_CDATA_5) {\n      this._stateBeforeCdata5(c);\n    } else if (this._state === BEFORE_CDATA_6) {\n      this._stateBeforeCdata6(c);\n    } else if (this._state === IN_CDATA) {\n      this._stateInCdata(c);\n    } else if (this._state === AFTER_CDATA_1) {\n      this._stateAfterCdata1(c);\n    } else if (this._state === AFTER_CDATA_2) {\n      this._stateAfterCdata2(c);\n    } else if (this._state === BEFORE_SPECIAL) {\n      /*\r\n      * special tags\r\n      */\n      this._stateBeforeSpecial(c);\n    } else if (this._state === BEFORE_SPECIAL_END) {\n      this._stateBeforeSpecialEnd(c);\n    } else if (this._state === BEFORE_SCRIPT_1) {\n      /*\r\n      * script\r\n      */\n      this._stateBeforeScript1(c);\n    } else if (this._state === BEFORE_SCRIPT_2) {\n      this._stateBeforeScript2(c);\n    } else if (this._state === BEFORE_SCRIPT_3) {\n      this._stateBeforeScript3(c);\n    } else if (this._state === BEFORE_SCRIPT_4) {\n      this._stateBeforeScript4(c);\n    } else if (this._state === BEFORE_SCRIPT_5) {\n      this._stateBeforeScript5(c);\n    } else if (this._state === AFTER_SCRIPT_1) {\n      this._stateAfterScript1(c);\n    } else if (this._state === AFTER_SCRIPT_2) {\n      this._stateAfterScript2(c);\n    } else if (this._state === AFTER_SCRIPT_3) {\n      this._stateAfterScript3(c);\n    } else if (this._state === AFTER_SCRIPT_4) {\n      this._stateAfterScript4(c);\n    } else if (this._state === AFTER_SCRIPT_5) {\n      this._stateAfterScript5(c);\n    } else if (this._state === BEFORE_STYLE_1) {\n      /*\r\n      * style\r\n      */\n      this._stateBeforeStyle1(c);\n    } else if (this._state === BEFORE_STYLE_2) {\n      this._stateBeforeStyle2(c);\n    } else if (this._state === BEFORE_STYLE_3) {\n      this._stateBeforeStyle3(c);\n    } else if (this._state === BEFORE_STYLE_4) {\n      this._stateBeforeStyle4(c);\n    } else if (this._state === AFTER_STYLE_1) {\n      this._stateAfterStyle1(c);\n    } else if (this._state === AFTER_STYLE_2) {\n      this._stateAfterStyle2(c);\n    } else if (this._state === AFTER_STYLE_3) {\n      this._stateAfterStyle3(c);\n    } else if (this._state === AFTER_STYLE_4) {\n      this._stateAfterStyle4(c);\n    } else if (this._state === BEFORE_ENTITY) {\n      /*\r\n      * entities\r\n      */\n      this._stateBeforeEntity(c);\n    } else if (this._state === BEFORE_NUMERIC_ENTITY) {\n      this._stateBeforeNumericEntity(c);\n    } else if (this._state === IN_NAMED_ENTITY) {\n      this._stateInNamedEntity(c);\n    } else if (this._state === IN_NUMERIC_ENTITY) {\n      this._stateInNumericEntity(c);\n    } else if (this._state === IN_HEX_ENTITY) {\n      this._stateInHexEntity(c);\n    } else {\n      this._cbs.onerror(Error(\"unknown _state\"), this._state);\n    }\n\n    this._index++;\n  }\n\n  this._cleanup();\n};\n\nTokenizer.prototype.pause = function () {\n  this._running = false;\n};\n\nTokenizer.prototype.resume = function () {\n  this._running = true;\n\n  if (this._index < this._buffer.length) {\n    this._parse();\n  }\n\n  if (this._ended) {\n    this._finish();\n  }\n};\n\nTokenizer.prototype.end = function (chunk) {\n  if (this._ended) this._cbs.onerror(Error(\".end() after done!\"));\n  if (chunk) this.write(chunk);\n  this._ended = true;\n  if (this._running) this._finish();\n};\n\nTokenizer.prototype._finish = function () {\n  //if there is remaining data, emit it in a reasonable way\n  if (this._sectionStart < this._index) {\n    this._handleTrailingData();\n  }\n\n  this._cbs.onend();\n};\n\nTokenizer.prototype._handleTrailingData = function () {\n  var data = this._buffer.substr(this._sectionStart);\n\n  if (this._state === IN_CDATA || this._state === AFTER_CDATA_1 || this._state === AFTER_CDATA_2) {\n    this._cbs.oncdata(data);\n  } else if (this._state === IN_COMMENT || this._state === AFTER_COMMENT_1 || this._state === AFTER_COMMENT_2) {\n    this._cbs.oncomment(data);\n  } else if (this._state === IN_NAMED_ENTITY && !this._xmlMode) {\n    this._parseLegacyEntity();\n\n    if (this._sectionStart < this._index) {\n      this._state = this._baseState;\n\n      this._handleTrailingData();\n    }\n  } else if (this._state === IN_NUMERIC_ENTITY && !this._xmlMode) {\n    this._decodeNumericEntity(2, 10);\n\n    if (this._sectionStart < this._index) {\n      this._state = this._baseState;\n\n      this._handleTrailingData();\n    }\n  } else if (this._state === IN_HEX_ENTITY && !this._xmlMode) {\n    this._decodeNumericEntity(3, 16);\n\n    if (this._sectionStart < this._index) {\n      this._state = this._baseState;\n\n      this._handleTrailingData();\n    }\n  } else if (this._state !== IN_TAG_NAME && this._state !== BEFORE_ATTRIBUTE_NAME && this._state !== BEFORE_ATTRIBUTE_VALUE && this._state !== AFTER_ATTRIBUTE_NAME && this._state !== IN_ATTRIBUTE_NAME && this._state !== IN_ATTRIBUTE_VALUE_SQ && this._state !== IN_ATTRIBUTE_VALUE_DQ && this._state !== IN_ATTRIBUTE_VALUE_NQ && this._state !== IN_CLOSING_TAG_NAME) {\n    this._cbs.ontext(data);\n  } //else, ignore remaining data\n  //TODO add a way to remove current tag\n\n};\n\nTokenizer.prototype.reset = function () {\n  Tokenizer.call(this, {\n    xmlMode: this._xmlMode,\n    decodeEntities: this._decodeEntities\n  }, this._cbs);\n};\n\nTokenizer.prototype.getAbsoluteIndex = function () {\n  return this._bufferOffset + this._index;\n};\n\nTokenizer.prototype._getSection = function () {\n  return this._buffer.substring(this._sectionStart, this._index);\n};\n\nTokenizer.prototype._emitToken = function (name) {\n  this._cbs[name](this._getSection());\n\n  this._sectionStart = -1;\n};\n\nTokenizer.prototype._emitPartial = function (value) {\n  if (this._baseState !== TEXT) {\n    this._cbs.onattribdata(value); //TODO implement the new event\n\n  } else {\n    this._cbs.ontext(value);\n  }\n};","map":{"version":3,"names":["module","exports","Tokenizer","decodeCodePoint","require","entityMap","legacyMap","xmlMap","i","TEXT","BEFORE_TAG_NAME","IN_TAG_NAME","IN_SELF_CLOSING_TAG","BEFORE_CLOSING_TAG_NAME","IN_CLOSING_TAG_NAME","AFTER_CLOSING_TAG_NAME","BEFORE_ATTRIBUTE_NAME","IN_ATTRIBUTE_NAME","AFTER_ATTRIBUTE_NAME","BEFORE_ATTRIBUTE_VALUE","IN_ATTRIBUTE_VALUE_DQ","IN_ATTRIBUTE_VALUE_SQ","IN_ATTRIBUTE_VALUE_NQ","BEFORE_DECLARATION","IN_DECLARATION","IN_PROCESSING_INSTRUCTION","BEFORE_COMMENT","IN_COMMENT","AFTER_COMMENT_1","AFTER_COMMENT_2","BEFORE_CDATA_1","BEFORE_CDATA_2","BEFORE_CDATA_3","BEFORE_CDATA_4","BEFORE_CDATA_5","BEFORE_CDATA_6","IN_CDATA","AFTER_CDATA_1","AFTER_CDATA_2","BEFORE_SPECIAL","BEFORE_SPECIAL_END","BEFORE_SCRIPT_1","BEFORE_SCRIPT_2","BEFORE_SCRIPT_3","BEFORE_SCRIPT_4","BEFORE_SCRIPT_5","AFTER_SCRIPT_1","AFTER_SCRIPT_2","AFTER_SCRIPT_3","AFTER_SCRIPT_4","AFTER_SCRIPT_5","BEFORE_STYLE_1","BEFORE_STYLE_2","BEFORE_STYLE_3","BEFORE_STYLE_4","AFTER_STYLE_1","AFTER_STYLE_2","AFTER_STYLE_3","AFTER_STYLE_4","BEFORE_ENTITY","BEFORE_NUMERIC_ENTITY","IN_NAMED_ENTITY","IN_NUMERIC_ENTITY","IN_HEX_ENTITY","j","SPECIAL_NONE","SPECIAL_SCRIPT","SPECIAL_STYLE","whitespace","c","ifElseState","upper","SUCCESS","FAILURE","lower","toLowerCase","_state","_index","consumeSpecialNameChar","NEXT_STATE","options","cbs","_buffer","_sectionStart","_bufferOffset","_baseState","_special","_cbs","_running","_ended","_xmlMode","xmlMode","_decodeEntities","decodeEntities","prototype","_stateText","ontext","_getSection","_stateBeforeTagName","_stateInTagName","_emitToken","_stateBeforeCloseingTagName","_stateInCloseingTagName","_stateAfterCloseingTagName","_stateBeforeAttributeName","onopentagend","_stateInSelfClosingTag","onselfclosingtag","_stateInAttributeName","onattribname","_stateAfterAttributeName","onattribend","_stateBeforeAttributeValue","_stateInAttributeValueDoubleQuotes","_stateInAttributeValueSingleQuotes","_stateInAttributeValueNoQuotes","_stateBeforeDeclaration","_stateInDeclaration","ondeclaration","_stateInProcessingInstruction","onprocessinginstruction","_stateBeforeComment","_stateInComment","_stateAfterComment1","_stateAfterComment2","oncomment","substring","_stateBeforeCdata1","_stateBeforeCdata2","_stateBeforeCdata3","_stateBeforeCdata4","_stateBeforeCdata5","_stateBeforeCdata6","_stateInCdata","_stateAfterCdata1","_stateAfterCdata2","oncdata","_stateBeforeSpecial","_stateBeforeSpecialEnd","_stateBeforeScript1","_stateBeforeScript2","_stateBeforeScript3","_stateBeforeScript4","_stateBeforeScript5","_stateAfterScript1","_stateAfterScript2","_stateAfterScript3","_stateAfterScript4","_stateAfterScript5","_stateBeforeStyle1","_stateBeforeStyle2","_stateBeforeStyle3","_stateBeforeStyle4","_stateAfterStyle1","_stateAfterStyle2","_stateAfterStyle3","_stateAfterStyle4","_stateBeforeEntity","_stateBeforeNumericEntity","_parseNamedEntityStrict","entity","map","hasOwnProperty","_emitPartial","_parseLegacyEntity","start","limit","substr","_stateInNamedEntity","_decodeNumericEntity","offset","base","sectionStart","parsed","parseInt","_stateInNumericEntity","_stateInHexEntity","_cleanup","write","chunk","onerror","Error","_parse","length","charAt","pause","resume","_finish","end","_handleTrailingData","onend","data","reset","call","getAbsoluteIndex","name","value","onattribdata"],"sources":["D:/cryptoStato/node_modules/htmlparser2/lib/Tokenizer.js"],"sourcesContent":["module.exports = Tokenizer;\r\n\r\nvar decodeCodePoint = require(\"entities/lib/decode_codepoint.js\");\r\nvar entityMap = require(\"entities/maps/entities.json\");\r\nvar legacyMap = require(\"entities/maps/legacy.json\");\r\nvar xmlMap = require(\"entities/maps/xml.json\");\r\n\r\nvar i = 0;\r\n\r\nvar TEXT = i++;\r\nvar BEFORE_TAG_NAME = i++; //after <\r\nvar IN_TAG_NAME = i++;\r\nvar IN_SELF_CLOSING_TAG = i++;\r\nvar BEFORE_CLOSING_TAG_NAME = i++;\r\nvar IN_CLOSING_TAG_NAME = i++;\r\nvar AFTER_CLOSING_TAG_NAME = i++;\r\n\r\n//attributes\r\nvar BEFORE_ATTRIBUTE_NAME = i++;\r\nvar IN_ATTRIBUTE_NAME = i++;\r\nvar AFTER_ATTRIBUTE_NAME = i++;\r\nvar BEFORE_ATTRIBUTE_VALUE = i++;\r\nvar IN_ATTRIBUTE_VALUE_DQ = i++; // \"\r\nvar IN_ATTRIBUTE_VALUE_SQ = i++; // '\r\nvar IN_ATTRIBUTE_VALUE_NQ = i++;\r\n\r\n//declarations\r\nvar BEFORE_DECLARATION = i++; // !\r\nvar IN_DECLARATION = i++;\r\n\r\n//processing instructions\r\nvar IN_PROCESSING_INSTRUCTION = i++; // ?\r\n\r\n//comments\r\nvar BEFORE_COMMENT = i++;\r\nvar IN_COMMENT = i++;\r\nvar AFTER_COMMENT_1 = i++;\r\nvar AFTER_COMMENT_2 = i++;\r\n\r\n//cdata\r\nvar BEFORE_CDATA_1 = i++; // [\r\nvar BEFORE_CDATA_2 = i++; // C\r\nvar BEFORE_CDATA_3 = i++; // D\r\nvar BEFORE_CDATA_4 = i++; // A\r\nvar BEFORE_CDATA_5 = i++; // T\r\nvar BEFORE_CDATA_6 = i++; // A\r\nvar IN_CDATA = i++; // [\r\nvar AFTER_CDATA_1 = i++; // ]\r\nvar AFTER_CDATA_2 = i++; // ]\r\n\r\n//special tags\r\nvar BEFORE_SPECIAL = i++; //S\r\nvar BEFORE_SPECIAL_END = i++; //S\r\n\r\nvar BEFORE_SCRIPT_1 = i++; //C\r\nvar BEFORE_SCRIPT_2 = i++; //R\r\nvar BEFORE_SCRIPT_3 = i++; //I\r\nvar BEFORE_SCRIPT_4 = i++; //P\r\nvar BEFORE_SCRIPT_5 = i++; //T\r\nvar AFTER_SCRIPT_1 = i++; //C\r\nvar AFTER_SCRIPT_2 = i++; //R\r\nvar AFTER_SCRIPT_3 = i++; //I\r\nvar AFTER_SCRIPT_4 = i++; //P\r\nvar AFTER_SCRIPT_5 = i++; //T\r\n\r\nvar BEFORE_STYLE_1 = i++; //T\r\nvar BEFORE_STYLE_2 = i++; //Y\r\nvar BEFORE_STYLE_3 = i++; //L\r\nvar BEFORE_STYLE_4 = i++; //E\r\nvar AFTER_STYLE_1 = i++; //T\r\nvar AFTER_STYLE_2 = i++; //Y\r\nvar AFTER_STYLE_3 = i++; //L\r\nvar AFTER_STYLE_4 = i++; //E\r\n\r\nvar BEFORE_ENTITY = i++; //&\r\nvar BEFORE_NUMERIC_ENTITY = i++; //#\r\nvar IN_NAMED_ENTITY = i++;\r\nvar IN_NUMERIC_ENTITY = i++;\r\nvar IN_HEX_ENTITY = i++; //X\r\n\r\nvar j = 0;\r\n\r\nvar SPECIAL_NONE = j++;\r\nvar SPECIAL_SCRIPT = j++;\r\nvar SPECIAL_STYLE = j++;\r\n\r\nfunction whitespace(c) {\r\n    return c === \" \" || c === \"\\n\" || c === \"\\t\" || c === \"\\f\" || c === \"\\r\";\r\n}\r\n\r\nfunction ifElseState(upper, SUCCESS, FAILURE) {\r\n    var lower = upper.toLowerCase();\r\n\r\n    if (upper === lower) {\r\n        return function(c) {\r\n            if (c === lower) {\r\n                this._state = SUCCESS;\r\n            } else {\r\n                this._state = FAILURE;\r\n                this._index--;\r\n            }\r\n        };\r\n    } else {\r\n        return function(c) {\r\n            if (c === lower || c === upper) {\r\n                this._state = SUCCESS;\r\n            } else {\r\n                this._state = FAILURE;\r\n                this._index--;\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nfunction consumeSpecialNameChar(upper, NEXT_STATE) {\r\n    var lower = upper.toLowerCase();\r\n\r\n    return function(c) {\r\n        if (c === lower || c === upper) {\r\n            this._state = NEXT_STATE;\r\n        } else {\r\n            this._state = IN_TAG_NAME;\r\n            this._index--; //consume the token again\r\n        }\r\n    };\r\n}\r\n\r\nfunction Tokenizer(options, cbs) {\r\n    this._state = TEXT;\r\n    this._buffer = \"\";\r\n    this._sectionStart = 0;\r\n    this._index = 0;\r\n    this._bufferOffset = 0; //chars removed from _buffer\r\n    this._baseState = TEXT;\r\n    this._special = SPECIAL_NONE;\r\n    this._cbs = cbs;\r\n    this._running = true;\r\n    this._ended = false;\r\n    this._xmlMode = !!(options && options.xmlMode);\r\n    this._decodeEntities = !!(options && options.decodeEntities);\r\n}\r\n\r\nTokenizer.prototype._stateText = function(c) {\r\n    if (c === \"<\") {\r\n        if (this._index > this._sectionStart) {\r\n            this._cbs.ontext(this._getSection());\r\n        }\r\n        this._state = BEFORE_TAG_NAME;\r\n        this._sectionStart = this._index;\r\n    } else if (\r\n        this._decodeEntities &&\r\n        this._special === SPECIAL_NONE &&\r\n        c === \"&\"\r\n    ) {\r\n        if (this._index > this._sectionStart) {\r\n            this._cbs.ontext(this._getSection());\r\n        }\r\n        this._baseState = TEXT;\r\n        this._state = BEFORE_ENTITY;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateBeforeTagName = function(c) {\r\n    if (c === \"/\") {\r\n        this._state = BEFORE_CLOSING_TAG_NAME;\r\n    } else if (c === \"<\") {\r\n        this._cbs.ontext(this._getSection());\r\n        this._sectionStart = this._index;\r\n    } else if (c === \">\" || this._special !== SPECIAL_NONE || whitespace(c)) {\r\n        this._state = TEXT;\r\n    } else if (c === \"!\") {\r\n        this._state = BEFORE_DECLARATION;\r\n        this._sectionStart = this._index + 1;\r\n    } else if (c === \"?\") {\r\n        this._state = IN_PROCESSING_INSTRUCTION;\r\n        this._sectionStart = this._index + 1;\r\n    } else {\r\n        this._state =\r\n            !this._xmlMode && (c === \"s\" || c === \"S\")\r\n                ? BEFORE_SPECIAL\r\n                : IN_TAG_NAME;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInTagName = function(c) {\r\n    if (c === \"/\" || c === \">\" || whitespace(c)) {\r\n        this._emitToken(\"onopentagname\");\r\n        this._state = BEFORE_ATTRIBUTE_NAME;\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateBeforeCloseingTagName = function(c) {\r\n    if (whitespace(c));\r\n    else if (c === \">\") {\r\n        this._state = TEXT;\r\n    } else if (this._special !== SPECIAL_NONE) {\r\n        if (c === \"s\" || c === \"S\") {\r\n            this._state = BEFORE_SPECIAL_END;\r\n        } else {\r\n            this._state = TEXT;\r\n            this._index--;\r\n        }\r\n    } else {\r\n        this._state = IN_CLOSING_TAG_NAME;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInCloseingTagName = function(c) {\r\n    if (c === \">\" || whitespace(c)) {\r\n        this._emitToken(\"onclosetag\");\r\n        this._state = AFTER_CLOSING_TAG_NAME;\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateAfterCloseingTagName = function(c) {\r\n    //skip everything until \">\"\r\n    if (c === \">\") {\r\n        this._state = TEXT;\r\n        this._sectionStart = this._index + 1;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateBeforeAttributeName = function(c) {\r\n    if (c === \">\") {\r\n        this._cbs.onopentagend();\r\n        this._state = TEXT;\r\n        this._sectionStart = this._index + 1;\r\n    } else if (c === \"/\") {\r\n        this._state = IN_SELF_CLOSING_TAG;\r\n    } else if (!whitespace(c)) {\r\n        this._state = IN_ATTRIBUTE_NAME;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInSelfClosingTag = function(c) {\r\n    if (c === \">\") {\r\n        this._cbs.onselfclosingtag();\r\n        this._state = TEXT;\r\n        this._sectionStart = this._index + 1;\r\n    } else if (!whitespace(c)) {\r\n        this._state = BEFORE_ATTRIBUTE_NAME;\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInAttributeName = function(c) {\r\n    if (c === \"=\" || c === \"/\" || c === \">\" || whitespace(c)) {\r\n        this._cbs.onattribname(this._getSection());\r\n        this._sectionStart = -1;\r\n        this._state = AFTER_ATTRIBUTE_NAME;\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateAfterAttributeName = function(c) {\r\n    if (c === \"=\") {\r\n        this._state = BEFORE_ATTRIBUTE_VALUE;\r\n    } else if (c === \"/\" || c === \">\") {\r\n        this._cbs.onattribend();\r\n        this._state = BEFORE_ATTRIBUTE_NAME;\r\n        this._index--;\r\n    } else if (!whitespace(c)) {\r\n        this._cbs.onattribend();\r\n        this._state = IN_ATTRIBUTE_NAME;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateBeforeAttributeValue = function(c) {\r\n    if (c === '\"') {\r\n        this._state = IN_ATTRIBUTE_VALUE_DQ;\r\n        this._sectionStart = this._index + 1;\r\n    } else if (c === \"'\") {\r\n        this._state = IN_ATTRIBUTE_VALUE_SQ;\r\n        this._sectionStart = this._index + 1;\r\n    } else if (!whitespace(c)) {\r\n        this._state = IN_ATTRIBUTE_VALUE_NQ;\r\n        this._sectionStart = this._index;\r\n        this._index--; //reconsume token\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInAttributeValueDoubleQuotes = function(c) {\r\n    if (c === '\"') {\r\n        this._emitToken(\"onattribdata\");\r\n        this._cbs.onattribend();\r\n        this._state = BEFORE_ATTRIBUTE_NAME;\r\n    } else if (this._decodeEntities && c === \"&\") {\r\n        this._emitToken(\"onattribdata\");\r\n        this._baseState = this._state;\r\n        this._state = BEFORE_ENTITY;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInAttributeValueSingleQuotes = function(c) {\r\n    if (c === \"'\") {\r\n        this._emitToken(\"onattribdata\");\r\n        this._cbs.onattribend();\r\n        this._state = BEFORE_ATTRIBUTE_NAME;\r\n    } else if (this._decodeEntities && c === \"&\") {\r\n        this._emitToken(\"onattribdata\");\r\n        this._baseState = this._state;\r\n        this._state = BEFORE_ENTITY;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInAttributeValueNoQuotes = function(c) {\r\n    if (whitespace(c) || c === \">\") {\r\n        this._emitToken(\"onattribdata\");\r\n        this._cbs.onattribend();\r\n        this._state = BEFORE_ATTRIBUTE_NAME;\r\n        this._index--;\r\n    } else if (this._decodeEntities && c === \"&\") {\r\n        this._emitToken(\"onattribdata\");\r\n        this._baseState = this._state;\r\n        this._state = BEFORE_ENTITY;\r\n        this._sectionStart = this._index;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateBeforeDeclaration = function(c) {\r\n    this._state =\r\n        c === \"[\"\r\n            ? BEFORE_CDATA_1\r\n            : c === \"-\"\r\n                ? BEFORE_COMMENT\r\n                : IN_DECLARATION;\r\n};\r\n\r\nTokenizer.prototype._stateInDeclaration = function(c) {\r\n    if (c === \">\") {\r\n        this._cbs.ondeclaration(this._getSection());\r\n        this._state = TEXT;\r\n        this._sectionStart = this._index + 1;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInProcessingInstruction = function(c) {\r\n    if (c === \">\") {\r\n        this._cbs.onprocessinginstruction(this._getSection());\r\n        this._state = TEXT;\r\n        this._sectionStart = this._index + 1;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateBeforeComment = function(c) {\r\n    if (c === \"-\") {\r\n        this._state = IN_COMMENT;\r\n        this._sectionStart = this._index + 1;\r\n    } else {\r\n        this._state = IN_DECLARATION;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInComment = function(c) {\r\n    if (c === \"-\") this._state = AFTER_COMMENT_1;\r\n};\r\n\r\nTokenizer.prototype._stateAfterComment1 = function(c) {\r\n    if (c === \"-\") {\r\n        this._state = AFTER_COMMENT_2;\r\n    } else {\r\n        this._state = IN_COMMENT;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateAfterComment2 = function(c) {\r\n    if (c === \">\") {\r\n        //remove 2 trailing chars\r\n        this._cbs.oncomment(\r\n            this._buffer.substring(this._sectionStart, this._index - 2)\r\n        );\r\n        this._state = TEXT;\r\n        this._sectionStart = this._index + 1;\r\n    } else if (c !== \"-\") {\r\n        this._state = IN_COMMENT;\r\n    }\r\n    // else: stay in AFTER_COMMENT_2 (`--->`)\r\n};\r\n\r\nTokenizer.prototype._stateBeforeCdata1 = ifElseState(\r\n    \"C\",\r\n    BEFORE_CDATA_2,\r\n    IN_DECLARATION\r\n);\r\nTokenizer.prototype._stateBeforeCdata2 = ifElseState(\r\n    \"D\",\r\n    BEFORE_CDATA_3,\r\n    IN_DECLARATION\r\n);\r\nTokenizer.prototype._stateBeforeCdata3 = ifElseState(\r\n    \"A\",\r\n    BEFORE_CDATA_4,\r\n    IN_DECLARATION\r\n);\r\nTokenizer.prototype._stateBeforeCdata4 = ifElseState(\r\n    \"T\",\r\n    BEFORE_CDATA_5,\r\n    IN_DECLARATION\r\n);\r\nTokenizer.prototype._stateBeforeCdata5 = ifElseState(\r\n    \"A\",\r\n    BEFORE_CDATA_6,\r\n    IN_DECLARATION\r\n);\r\n\r\nTokenizer.prototype._stateBeforeCdata6 = function(c) {\r\n    if (c === \"[\") {\r\n        this._state = IN_CDATA;\r\n        this._sectionStart = this._index + 1;\r\n    } else {\r\n        this._state = IN_DECLARATION;\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInCdata = function(c) {\r\n    if (c === \"]\") this._state = AFTER_CDATA_1;\r\n};\r\n\r\nTokenizer.prototype._stateAfterCdata1 = function(c) {\r\n    if (c === \"]\") this._state = AFTER_CDATA_2;\r\n    else this._state = IN_CDATA;\r\n};\r\n\r\nTokenizer.prototype._stateAfterCdata2 = function(c) {\r\n    if (c === \">\") {\r\n        //remove 2 trailing chars\r\n        this._cbs.oncdata(\r\n            this._buffer.substring(this._sectionStart, this._index - 2)\r\n        );\r\n        this._state = TEXT;\r\n        this._sectionStart = this._index + 1;\r\n    } else if (c !== \"]\") {\r\n        this._state = IN_CDATA;\r\n    }\r\n    //else: stay in AFTER_CDATA_2 (`]]]>`)\r\n};\r\n\r\nTokenizer.prototype._stateBeforeSpecial = function(c) {\r\n    if (c === \"c\" || c === \"C\") {\r\n        this._state = BEFORE_SCRIPT_1;\r\n    } else if (c === \"t\" || c === \"T\") {\r\n        this._state = BEFORE_STYLE_1;\r\n    } else {\r\n        this._state = IN_TAG_NAME;\r\n        this._index--; //consume the token again\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateBeforeSpecialEnd = function(c) {\r\n    if (this._special === SPECIAL_SCRIPT && (c === \"c\" || c === \"C\")) {\r\n        this._state = AFTER_SCRIPT_1;\r\n    } else if (this._special === SPECIAL_STYLE && (c === \"t\" || c === \"T\")) {\r\n        this._state = AFTER_STYLE_1;\r\n    } else this._state = TEXT;\r\n};\r\n\r\nTokenizer.prototype._stateBeforeScript1 = consumeSpecialNameChar(\r\n    \"R\",\r\n    BEFORE_SCRIPT_2\r\n);\r\nTokenizer.prototype._stateBeforeScript2 = consumeSpecialNameChar(\r\n    \"I\",\r\n    BEFORE_SCRIPT_3\r\n);\r\nTokenizer.prototype._stateBeforeScript3 = consumeSpecialNameChar(\r\n    \"P\",\r\n    BEFORE_SCRIPT_4\r\n);\r\nTokenizer.prototype._stateBeforeScript4 = consumeSpecialNameChar(\r\n    \"T\",\r\n    BEFORE_SCRIPT_5\r\n);\r\n\r\nTokenizer.prototype._stateBeforeScript5 = function(c) {\r\n    if (c === \"/\" || c === \">\" || whitespace(c)) {\r\n        this._special = SPECIAL_SCRIPT;\r\n    }\r\n    this._state = IN_TAG_NAME;\r\n    this._index--; //consume the token again\r\n};\r\n\r\nTokenizer.prototype._stateAfterScript1 = ifElseState(\"R\", AFTER_SCRIPT_2, TEXT);\r\nTokenizer.prototype._stateAfterScript2 = ifElseState(\"I\", AFTER_SCRIPT_3, TEXT);\r\nTokenizer.prototype._stateAfterScript3 = ifElseState(\"P\", AFTER_SCRIPT_4, TEXT);\r\nTokenizer.prototype._stateAfterScript4 = ifElseState(\"T\", AFTER_SCRIPT_5, TEXT);\r\n\r\nTokenizer.prototype._stateAfterScript5 = function(c) {\r\n    if (c === \">\" || whitespace(c)) {\r\n        this._special = SPECIAL_NONE;\r\n        this._state = IN_CLOSING_TAG_NAME;\r\n        this._sectionStart = this._index - 6;\r\n        this._index--; //reconsume the token\r\n    } else this._state = TEXT;\r\n};\r\n\r\nTokenizer.prototype._stateBeforeStyle1 = consumeSpecialNameChar(\r\n    \"Y\",\r\n    BEFORE_STYLE_2\r\n);\r\nTokenizer.prototype._stateBeforeStyle2 = consumeSpecialNameChar(\r\n    \"L\",\r\n    BEFORE_STYLE_3\r\n);\r\nTokenizer.prototype._stateBeforeStyle3 = consumeSpecialNameChar(\r\n    \"E\",\r\n    BEFORE_STYLE_4\r\n);\r\n\r\nTokenizer.prototype._stateBeforeStyle4 = function(c) {\r\n    if (c === \"/\" || c === \">\" || whitespace(c)) {\r\n        this._special = SPECIAL_STYLE;\r\n    }\r\n    this._state = IN_TAG_NAME;\r\n    this._index--; //consume the token again\r\n};\r\n\r\nTokenizer.prototype._stateAfterStyle1 = ifElseState(\"Y\", AFTER_STYLE_2, TEXT);\r\nTokenizer.prototype._stateAfterStyle2 = ifElseState(\"L\", AFTER_STYLE_3, TEXT);\r\nTokenizer.prototype._stateAfterStyle3 = ifElseState(\"E\", AFTER_STYLE_4, TEXT);\r\n\r\nTokenizer.prototype._stateAfterStyle4 = function(c) {\r\n    if (c === \">\" || whitespace(c)) {\r\n        this._special = SPECIAL_NONE;\r\n        this._state = IN_CLOSING_TAG_NAME;\r\n        this._sectionStart = this._index - 5;\r\n        this._index--; //reconsume the token\r\n    } else this._state = TEXT;\r\n};\r\n\r\nTokenizer.prototype._stateBeforeEntity = ifElseState(\r\n    \"#\",\r\n    BEFORE_NUMERIC_ENTITY,\r\n    IN_NAMED_ENTITY\r\n);\r\nTokenizer.prototype._stateBeforeNumericEntity = ifElseState(\r\n    \"X\",\r\n    IN_HEX_ENTITY,\r\n    IN_NUMERIC_ENTITY\r\n);\r\n\r\n//for entities terminated with a semicolon\r\nTokenizer.prototype._parseNamedEntityStrict = function() {\r\n    //offset = 1\r\n    if (this._sectionStart + 1 < this._index) {\r\n        var entity = this._buffer.substring(\r\n                this._sectionStart + 1,\r\n                this._index\r\n            ),\r\n            map = this._xmlMode ? xmlMap : entityMap;\r\n\r\n        if (map.hasOwnProperty(entity)) {\r\n            this._emitPartial(map[entity]);\r\n            this._sectionStart = this._index + 1;\r\n        }\r\n    }\r\n};\r\n\r\n//parses legacy entities (without trailing semicolon)\r\nTokenizer.prototype._parseLegacyEntity = function() {\r\n    var start = this._sectionStart + 1,\r\n        limit = this._index - start;\r\n\r\n    if (limit > 6) limit = 6; //the max length of legacy entities is 6\r\n\r\n    while (limit >= 2) {\r\n        //the min length of legacy entities is 2\r\n        var entity = this._buffer.substr(start, limit);\r\n\r\n        if (legacyMap.hasOwnProperty(entity)) {\r\n            this._emitPartial(legacyMap[entity]);\r\n            this._sectionStart += limit + 1;\r\n            return;\r\n        } else {\r\n            limit--;\r\n        }\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInNamedEntity = function(c) {\r\n    if (c === \";\") {\r\n        this._parseNamedEntityStrict();\r\n        if (this._sectionStart + 1 < this._index && !this._xmlMode) {\r\n            this._parseLegacyEntity();\r\n        }\r\n        this._state = this._baseState;\r\n    } else if (\r\n        (c < \"a\" || c > \"z\") &&\r\n        (c < \"A\" || c > \"Z\") &&\r\n        (c < \"0\" || c > \"9\")\r\n    ) {\r\n        if (this._xmlMode);\r\n        else if (this._sectionStart + 1 === this._index);\r\n        else if (this._baseState !== TEXT) {\r\n            if (c !== \"=\") {\r\n                this._parseNamedEntityStrict();\r\n            }\r\n        } else {\r\n            this._parseLegacyEntity();\r\n        }\r\n\r\n        this._state = this._baseState;\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._decodeNumericEntity = function(offset, base) {\r\n    var sectionStart = this._sectionStart + offset;\r\n\r\n    if (sectionStart !== this._index) {\r\n        //parse entity\r\n        var entity = this._buffer.substring(sectionStart, this._index);\r\n        var parsed = parseInt(entity, base);\r\n\r\n        this._emitPartial(decodeCodePoint(parsed));\r\n        this._sectionStart = this._index;\r\n    } else {\r\n        this._sectionStart--;\r\n    }\r\n\r\n    this._state = this._baseState;\r\n};\r\n\r\nTokenizer.prototype._stateInNumericEntity = function(c) {\r\n    if (c === \";\") {\r\n        this._decodeNumericEntity(2, 10);\r\n        this._sectionStart++;\r\n    } else if (c < \"0\" || c > \"9\") {\r\n        if (!this._xmlMode) {\r\n            this._decodeNumericEntity(2, 10);\r\n        } else {\r\n            this._state = this._baseState;\r\n        }\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._stateInHexEntity = function(c) {\r\n    if (c === \";\") {\r\n        this._decodeNumericEntity(3, 16);\r\n        this._sectionStart++;\r\n    } else if (\r\n        (c < \"a\" || c > \"f\") &&\r\n        (c < \"A\" || c > \"F\") &&\r\n        (c < \"0\" || c > \"9\")\r\n    ) {\r\n        if (!this._xmlMode) {\r\n            this._decodeNumericEntity(3, 16);\r\n        } else {\r\n            this._state = this._baseState;\r\n        }\r\n        this._index--;\r\n    }\r\n};\r\n\r\nTokenizer.prototype._cleanup = function() {\r\n    if (this._sectionStart < 0) {\r\n        this._buffer = \"\";\r\n        this._bufferOffset += this._index;\r\n        this._index = 0;\r\n    } else if (this._running) {\r\n        if (this._state === TEXT) {\r\n            if (this._sectionStart !== this._index) {\r\n                this._cbs.ontext(this._buffer.substr(this._sectionStart));\r\n            }\r\n            this._buffer = \"\";\r\n            this._bufferOffset += this._index;\r\n            this._index = 0;\r\n        } else if (this._sectionStart === this._index) {\r\n            //the section just started\r\n            this._buffer = \"\";\r\n            this._bufferOffset += this._index;\r\n            this._index = 0;\r\n        } else {\r\n            //remove everything unnecessary\r\n            this._buffer = this._buffer.substr(this._sectionStart);\r\n            this._index -= this._sectionStart;\r\n            this._bufferOffset += this._sectionStart;\r\n        }\r\n\r\n        this._sectionStart = 0;\r\n    }\r\n};\r\n\r\n//TODO make events conditional\r\nTokenizer.prototype.write = function(chunk) {\r\n    if (this._ended) this._cbs.onerror(Error(\".write() after done!\"));\r\n\r\n    this._buffer += chunk;\r\n    this._parse();\r\n};\r\n\r\nTokenizer.prototype._parse = function() {\r\n    while (this._index < this._buffer.length && this._running) {\r\n        var c = this._buffer.charAt(this._index);\r\n        if (this._state === TEXT) {\r\n            this._stateText(c);\r\n        } else if (this._state === BEFORE_TAG_NAME) {\r\n            this._stateBeforeTagName(c);\r\n        } else if (this._state === IN_TAG_NAME) {\r\n            this._stateInTagName(c);\r\n        } else if (this._state === BEFORE_CLOSING_TAG_NAME) {\r\n            this._stateBeforeCloseingTagName(c);\r\n        } else if (this._state === IN_CLOSING_TAG_NAME) {\r\n            this._stateInCloseingTagName(c);\r\n        } else if (this._state === AFTER_CLOSING_TAG_NAME) {\r\n            this._stateAfterCloseingTagName(c);\r\n        } else if (this._state === IN_SELF_CLOSING_TAG) {\r\n            this._stateInSelfClosingTag(c);\r\n        } else if (this._state === BEFORE_ATTRIBUTE_NAME) {\r\n\r\n        /*\r\n\t\t*\tattributes\r\n\t\t*/\r\n            this._stateBeforeAttributeName(c);\r\n        } else if (this._state === IN_ATTRIBUTE_NAME) {\r\n            this._stateInAttributeName(c);\r\n        } else if (this._state === AFTER_ATTRIBUTE_NAME) {\r\n            this._stateAfterAttributeName(c);\r\n        } else if (this._state === BEFORE_ATTRIBUTE_VALUE) {\r\n            this._stateBeforeAttributeValue(c);\r\n        } else if (this._state === IN_ATTRIBUTE_VALUE_DQ) {\r\n            this._stateInAttributeValueDoubleQuotes(c);\r\n        } else if (this._state === IN_ATTRIBUTE_VALUE_SQ) {\r\n            this._stateInAttributeValueSingleQuotes(c);\r\n        } else if (this._state === IN_ATTRIBUTE_VALUE_NQ) {\r\n            this._stateInAttributeValueNoQuotes(c);\r\n        } else if (this._state === BEFORE_DECLARATION) {\r\n\r\n        /*\r\n\t\t*\tdeclarations\r\n\t\t*/\r\n            this._stateBeforeDeclaration(c);\r\n        } else if (this._state === IN_DECLARATION) {\r\n            this._stateInDeclaration(c);\r\n        } else if (this._state === IN_PROCESSING_INSTRUCTION) {\r\n\r\n        /*\r\n\t\t*\tprocessing instructions\r\n\t\t*/\r\n            this._stateInProcessingInstruction(c);\r\n        } else if (this._state === BEFORE_COMMENT) {\r\n\r\n        /*\r\n\t\t*\tcomments\r\n\t\t*/\r\n            this._stateBeforeComment(c);\r\n        } else if (this._state === IN_COMMENT) {\r\n            this._stateInComment(c);\r\n        } else if (this._state === AFTER_COMMENT_1) {\r\n            this._stateAfterComment1(c);\r\n        } else if (this._state === AFTER_COMMENT_2) {\r\n            this._stateAfterComment2(c);\r\n        } else if (this._state === BEFORE_CDATA_1) {\r\n\r\n        /*\r\n\t\t*\tcdata\r\n\t\t*/\r\n            this._stateBeforeCdata1(c);\r\n        } else if (this._state === BEFORE_CDATA_2) {\r\n            this._stateBeforeCdata2(c);\r\n        } else if (this._state === BEFORE_CDATA_3) {\r\n            this._stateBeforeCdata3(c);\r\n        } else if (this._state === BEFORE_CDATA_4) {\r\n            this._stateBeforeCdata4(c);\r\n        } else if (this._state === BEFORE_CDATA_5) {\r\n            this._stateBeforeCdata5(c);\r\n        } else if (this._state === BEFORE_CDATA_6) {\r\n            this._stateBeforeCdata6(c);\r\n        } else if (this._state === IN_CDATA) {\r\n            this._stateInCdata(c);\r\n        } else if (this._state === AFTER_CDATA_1) {\r\n            this._stateAfterCdata1(c);\r\n        } else if (this._state === AFTER_CDATA_2) {\r\n            this._stateAfterCdata2(c);\r\n        } else if (this._state === BEFORE_SPECIAL) {\r\n\r\n        /*\r\n\t\t* special tags\r\n\t\t*/\r\n            this._stateBeforeSpecial(c);\r\n        } else if (this._state === BEFORE_SPECIAL_END) {\r\n            this._stateBeforeSpecialEnd(c);\r\n        } else if (this._state === BEFORE_SCRIPT_1) {\r\n\r\n        /*\r\n\t\t* script\r\n\t\t*/\r\n            this._stateBeforeScript1(c);\r\n        } else if (this._state === BEFORE_SCRIPT_2) {\r\n            this._stateBeforeScript2(c);\r\n        } else if (this._state === BEFORE_SCRIPT_3) {\r\n            this._stateBeforeScript3(c);\r\n        } else if (this._state === BEFORE_SCRIPT_4) {\r\n            this._stateBeforeScript4(c);\r\n        } else if (this._state === BEFORE_SCRIPT_5) {\r\n            this._stateBeforeScript5(c);\r\n        } else if (this._state === AFTER_SCRIPT_1) {\r\n            this._stateAfterScript1(c);\r\n        } else if (this._state === AFTER_SCRIPT_2) {\r\n            this._stateAfterScript2(c);\r\n        } else if (this._state === AFTER_SCRIPT_3) {\r\n            this._stateAfterScript3(c);\r\n        } else if (this._state === AFTER_SCRIPT_4) {\r\n            this._stateAfterScript4(c);\r\n        } else if (this._state === AFTER_SCRIPT_5) {\r\n            this._stateAfterScript5(c);\r\n        } else if (this._state === BEFORE_STYLE_1) {\r\n\r\n        /*\r\n\t\t* style\r\n\t\t*/\r\n            this._stateBeforeStyle1(c);\r\n        } else if (this._state === BEFORE_STYLE_2) {\r\n            this._stateBeforeStyle2(c);\r\n        } else if (this._state === BEFORE_STYLE_3) {\r\n            this._stateBeforeStyle3(c);\r\n        } else if (this._state === BEFORE_STYLE_4) {\r\n            this._stateBeforeStyle4(c);\r\n        } else if (this._state === AFTER_STYLE_1) {\r\n            this._stateAfterStyle1(c);\r\n        } else if (this._state === AFTER_STYLE_2) {\r\n            this._stateAfterStyle2(c);\r\n        } else if (this._state === AFTER_STYLE_3) {\r\n            this._stateAfterStyle3(c);\r\n        } else if (this._state === AFTER_STYLE_4) {\r\n            this._stateAfterStyle4(c);\r\n        } else if (this._state === BEFORE_ENTITY) {\r\n\r\n        /*\r\n\t\t* entities\r\n\t\t*/\r\n            this._stateBeforeEntity(c);\r\n        } else if (this._state === BEFORE_NUMERIC_ENTITY) {\r\n            this._stateBeforeNumericEntity(c);\r\n        } else if (this._state === IN_NAMED_ENTITY) {\r\n            this._stateInNamedEntity(c);\r\n        } else if (this._state === IN_NUMERIC_ENTITY) {\r\n            this._stateInNumericEntity(c);\r\n        } else if (this._state === IN_HEX_ENTITY) {\r\n            this._stateInHexEntity(c);\r\n        } else {\r\n            this._cbs.onerror(Error(\"unknown _state\"), this._state);\r\n        }\r\n\r\n        this._index++;\r\n    }\r\n\r\n    this._cleanup();\r\n};\r\n\r\nTokenizer.prototype.pause = function() {\r\n    this._running = false;\r\n};\r\nTokenizer.prototype.resume = function() {\r\n    this._running = true;\r\n\r\n    if (this._index < this._buffer.length) {\r\n        this._parse();\r\n    }\r\n    if (this._ended) {\r\n        this._finish();\r\n    }\r\n};\r\n\r\nTokenizer.prototype.end = function(chunk) {\r\n    if (this._ended) this._cbs.onerror(Error(\".end() after done!\"));\r\n    if (chunk) this.write(chunk);\r\n\r\n    this._ended = true;\r\n\r\n    if (this._running) this._finish();\r\n};\r\n\r\nTokenizer.prototype._finish = function() {\r\n    //if there is remaining data, emit it in a reasonable way\r\n    if (this._sectionStart < this._index) {\r\n        this._handleTrailingData();\r\n    }\r\n\r\n    this._cbs.onend();\r\n};\r\n\r\nTokenizer.prototype._handleTrailingData = function() {\r\n    var data = this._buffer.substr(this._sectionStart);\r\n\r\n    if (\r\n        this._state === IN_CDATA ||\r\n        this._state === AFTER_CDATA_1 ||\r\n        this._state === AFTER_CDATA_2\r\n    ) {\r\n        this._cbs.oncdata(data);\r\n    } else if (\r\n        this._state === IN_COMMENT ||\r\n        this._state === AFTER_COMMENT_1 ||\r\n        this._state === AFTER_COMMENT_2\r\n    ) {\r\n        this._cbs.oncomment(data);\r\n    } else if (this._state === IN_NAMED_ENTITY && !this._xmlMode) {\r\n        this._parseLegacyEntity();\r\n        if (this._sectionStart < this._index) {\r\n            this._state = this._baseState;\r\n            this._handleTrailingData();\r\n        }\r\n    } else if (this._state === IN_NUMERIC_ENTITY && !this._xmlMode) {\r\n        this._decodeNumericEntity(2, 10);\r\n        if (this._sectionStart < this._index) {\r\n            this._state = this._baseState;\r\n            this._handleTrailingData();\r\n        }\r\n    } else if (this._state === IN_HEX_ENTITY && !this._xmlMode) {\r\n        this._decodeNumericEntity(3, 16);\r\n        if (this._sectionStart < this._index) {\r\n            this._state = this._baseState;\r\n            this._handleTrailingData();\r\n        }\r\n    } else if (\r\n        this._state !== IN_TAG_NAME &&\r\n        this._state !== BEFORE_ATTRIBUTE_NAME &&\r\n        this._state !== BEFORE_ATTRIBUTE_VALUE &&\r\n        this._state !== AFTER_ATTRIBUTE_NAME &&\r\n        this._state !== IN_ATTRIBUTE_NAME &&\r\n        this._state !== IN_ATTRIBUTE_VALUE_SQ &&\r\n        this._state !== IN_ATTRIBUTE_VALUE_DQ &&\r\n        this._state !== IN_ATTRIBUTE_VALUE_NQ &&\r\n        this._state !== IN_CLOSING_TAG_NAME\r\n    ) {\r\n        this._cbs.ontext(data);\r\n    }\r\n    //else, ignore remaining data\r\n    //TODO add a way to remove current tag\r\n};\r\n\r\nTokenizer.prototype.reset = function() {\r\n    Tokenizer.call(\r\n        this,\r\n        { xmlMode: this._xmlMode, decodeEntities: this._decodeEntities },\r\n        this._cbs\r\n    );\r\n};\r\n\r\nTokenizer.prototype.getAbsoluteIndex = function() {\r\n    return this._bufferOffset + this._index;\r\n};\r\n\r\nTokenizer.prototype._getSection = function() {\r\n    return this._buffer.substring(this._sectionStart, this._index);\r\n};\r\n\r\nTokenizer.prototype._emitToken = function(name) {\r\n    this._cbs[name](this._getSection());\r\n    this._sectionStart = -1;\r\n};\r\n\r\nTokenizer.prototype._emitPartial = function(value) {\r\n    if (this._baseState !== TEXT) {\r\n        this._cbs.onattribdata(value); //TODO implement the new event\r\n    } else {\r\n        this._cbs.ontext(value);\r\n    }\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}